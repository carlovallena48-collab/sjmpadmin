<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Certificate Management - SJMP ADMIN</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="certificate.css">
</head>
<body>
<div class="dashboard-container">
  <aside class="sidebar">
    <button class="sidebar-toggle">
      <i class="fas fa-bars"></i>
    </button>
    <div class="church-logo">
      <i class="fa-solid fa-church"></i>
      <span>SJMP ADMIN</span>
    </div>
    <nav class="main-nav">
      <ul class="nav-links">
        <li><a href="dashboard.html" class="active"><i class="fa-solid fa-house-chimney"></i><span>Dashboard</span></a></li>
        <li class="nav-dropdown open">
          <a href="#"><i class="fa-solid fa-cross"></i><span>7 Sacraments</span><i class="fa-solid fa-chevron-down dropdown-icon"></i></a>
          <ul class="dropdown-menu">
            <li><a href="baptism.html"><span>Baptism</span></a></li>
            <li><a href="kumpil.html"><span>Confirmation</span></a></li>
            <li><a href="eucharist.html"><span>Eucharist</span></a></li>
            <li><a href="confession.html"><span>Confession</span></a></li>
            <li><a href="anointing.html"><span>Anointing of the Sick</span></a></li>
            <li><a href="holy-orders.html"><span>Holy Orders</span></a></li>
            <li><a href="matrimony.html"><span>Matrimony</span></a></li>
          </ul>
        </li>
          <li class="nav-dropdown open">
          <a href="#"><i class="fa-solid fa-cross"></i><span>Other Services</span><i class="fa-solid fa-chevron-down dropdown-icon"></i></a>
          <ul class="dropdown-menu">
            <li><a href="pamisa.html"><span>Pamisa</span></a></li>
            <li><a href="blessing.html"><span>Blessing</span></a></li>
            <li><a href="pamisapatay.html"><span>Pamisa sa patay</span></a></li>
          
          </ul>
        </li>
        <li><a href="usermanage.html"><i class="fa-solid fa-user-gear"></i><span>User Management</span></a></li>
        <li><a href="schedule.html"><i class="fa-solid fa-calendar-alt"></i><span>Schedule</span></a></li>
        <li><a href="certificate.html"><i class="fa-solid fa-globe"></i><span>Certificate Request</span></a></li>
        <li><a href="WebsiteManagement.html"><i class="fa-solid fa-globe"></i><span>Website Management</span></a></li>
    <li class="nav-logout"><a href="#" id="logoutLink"><i class="fa-solid fa-right-from-bracket"></i><span>Logout</span></a></li>
      </ul>
    </nav>
  </aside>
        <main class="main-content">
            <header class="header">
                <div class="search-bar">
                    <i class="fa-solid fa-magnifying-glass"></i>
                    <input type="text" id="searchInput" placeholder="Search for name...">
                </div>
                <div class="user-profile">
                    <i class="fa-solid fa-bell"></i>
                    <i class="fa-solid fa-comment-dots"></i>
                    <img src="images/LOGO.png" alt="User Profile">
                </div>
            </header>

            <section class="requests-section">
                <div class="box">
                    <div class="table-header-controls">
                        <h3 class="box-title">Certificate Requests</h3>
                        <div class="table-actions">
                            <button class="add-request-btn" id="addRequestBtn">
                                <i class="fa-solid fa-plus"></i> Add Request
                            </button>
                            <div class="filter-buttons">
                                <button class="active" data-status="all">All</button>
                                <button data-status="pending">Pending</button>
                                <button data-status="approved">Approved</button>
                                <button data-status="released">Released</button>
                                <button data-status="rejected">Rejected</button>
                            </div>
                        </div>
                    </div>
                    <div class="table-container">
                        <table class="certificate-table" id="requestsTable">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Requested By</th>
                                    <th>Date Requested</th>
                                    <th>Status</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                        <div class="empty-state" id="emptyState">No certificate requests found.</div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <div id="requestModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Certificate Request</h2>
                <span class="close-btn">&times;</span>
            </div>
            <form id="requestForm">
                <div class="form-row double">
                    <div class="form-group">
                        <label for="name">Pangalan ng May-ari ng Certificate:</label>
                        <input type="text" id="name" name="name" required>
                    </div>
                    <div class="form-group">
                        <label for="dateRequested">Petsa ng Request:</label>
                        <input type="date" id="dateRequested" name="dateRequested" required>
                    </div>
                </div>
                <div class="form-row double">
                    <div class="form-group">
                        <label for="requestedBy">Nag-request:</label>
                        <input type="text" id="requestedBy" name="requestedBy" required>
                    </div>
                    <div class="form-group">
                        <label for="contactNumber">Contact Number:</label>
                        <input type="tel" id="contactNumber" name="contactNumber" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="purpose">Layunin ng Certificate:</label>
                    <textarea id="purpose" name="purpose" rows="3" required></textarea>
                </div>
                <button type="submit" class="submit-btn" id="submitBtn">Submit Request</button>
            </form>
        </div>
    </div>

    <div id="alertContainer" class="custom-alert-container"></div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const addRequestBtn = document.getElementById('addRequestBtn');
        const modal = document.getElementById('requestModal');
        const closeBtn = document.querySelector('.modal .close-btn');
        const requestForm = document.getElementById('requestForm');
        const requestsTableBody = document.querySelector('#requestsTable tbody');
        const emptyState = document.getElementById('emptyState');
        const filterButtons = document.querySelectorAll('.filter-buttons button');
        const searchInput = document.getElementById('searchInput');
        const alertContainer = document.getElementById('alertContainer');
        const modalTitle = modal.querySelector('h2');
        const submitBtn = document.getElementById('submitBtn');
        const formInputs = requestForm.querySelectorAll('input, select, textarea');

        let allRequests = [];
        
        // Sample data to simulate certificate requests
        allRequests = [
            {
                "id": "cert-001",
                "name": "Juan Dela Cruz",
                "requestedBy": "Maria Santos",
                "dateRequested": "2024-10-20",
                "contactNumber": "09171234567",
                "purpose": "Para sa Enrollment sa School",
                "status": "pending"
            },
            {
                "id": "cert-002",
                "name": "Maria Clara",
                "requestedBy": "Maria Clara",
                "dateRequested": "2024-10-18",
                "contactNumber": "09209876543",
                "purpose": "Para sa Confirmation",
                "status": "approved"
            },
            {
                "id": "cert-003",
                "name": "Jose Rizal",
                "requestedBy": "Kanyang Kapatid",
                "dateRequested": "2024-10-15",
                "contactNumber": "09081122334",
                "purpose": "Para sa Passport Application",
                "status": "released"
            }
        ];

        // --- NEW/UPDATED CODE FOR ALERTS ---
        function showAlert(message, type) {
            const alert = document.createElement('div');
            alert.className = `custom-alert ${type}`;
            alert.innerHTML = `
                <span>${message}</span>
                <button class="close-alert-btn">&times;</button>
            `;
            alertContainer.appendChild(alert);

            // Add event listener to close button
            alert.querySelector('.close-alert-btn').addEventListener('click', function() {
                alert.remove();
            });

            // Automatically remove alert after 5 seconds
            setTimeout(() => {
                if (alert.parentNode) {
                    alert.remove();
                }
            }, 5000);
        }

        // --- NEW CSS FOR THE CLOSE BUTTON ---
        // Pwede mo itong idagdag sa <style> block sa iyong HTML
        const newStyle = document.createElement('style');
        newStyle.innerHTML = `
            .custom-alert {
                position: relative;
            }
            .close-alert-btn {
                background: none;
                border: none;
                color: white;
                font-size: 1.5em;
                font-weight: bold;
                cursor: pointer;
                position: absolute;
                right: 10px;
                top: 50%;
                transform: translateY(-50%);
                opacity: 0.8;
                transition: opacity 0.2s;
            }
            .close-alert-btn:hover {
                opacity: 1;
            }
        `;
        document.head.appendChild(newStyle);
        // --- END OF NEW CODE FOR ALERTS ---

        // Function to render the table with filtered data
        function renderTable(requests) {
            requestsTableBody.innerHTML = '';
            if (requests.length === 0) {
                emptyState.style.display = 'block';
            } else {
                emptyState.style.display = 'none';
                requests.forEach(request => {
                    const row = document.createElement('tr');
                    const statusClass = request.status;
                    
                    row.dataset.id = request.id;
                    
                    let actionButtonsHTML = '';
                    switch(request.status) {
                        case 'pending':
                            actionButtonsHTML = `
                                <button class="approve-btn" title="Approve"><i class="fa-solid fa-check"></i></button>
                                <button class="reject-btn" title="Reject"><i class="fa-solid fa-xmark"></i></button>
                            `;
                            break;
                        case 'approved':
                            actionButtonsHTML = `
                                <button class="release-btn" title="Release"><i class="fa-solid fa-paper-plane"></i></button>
                                <button class="reject-btn" title="Reject"><i class="fa-solid fa-xmark"></i></button>
                            `;
                            break;
                        case 'released':
                            actionButtonsHTML = `
                                <button class="reapprove-btn" title="Re-release"><i class="fa-solid fa-retweet"></i></button>
                            `;
                            break;
                        case 'rejected':
                            actionButtonsHTML = `
                                <button class="reapprove-btn" title="Re-approve"><i class="fa-solid fa-undo"></i></button>
                            `;
                            break;
                    }

                    row.innerHTML = `
                        <td class="name-cell">${request.name}</td>
                        <td>${request.requestedBy}</td>
                        <td>${request.dateRequested}</td>
                        <td><span class="status-badge ${statusClass}">${statusClass.replace('-', ' ')}</span></td>
                        <td>
                            <div class="action-buttons">
                                ${actionButtonsHTML}
                            </div>
                        </td>
                    `;
                    requestsTableBody.appendChild(row);
                });
            }
        }

        // Handle form submission for adding a new request
        requestForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const newRequest = {
                id: 'cert-' + Date.now(), // Simple ID generator
                name: document.getElementById('name').value,
                requestedBy: document.getElementById('requestedBy').value,
                dateRequested: document.getElementById('dateRequested').value,
                contactNumber: document.getElementById('contactNumber').value,
                purpose: document.getElementById('purpose').value,
                status: 'pending'
            };

            allRequests.push(newRequest);
            renderTable(allRequests); // Render all to show the new entry

            modal.classList.remove('show');
            requestForm.reset();
            showAlert('Bagong request naidagdag!', 'success');
        });

        // Set modal to add mode
        function setFormAddMode() {
            modalTitle.textContent = 'Add Certificate Request';
            submitBtn.style.display = 'block';
            formInputs.forEach(input => input.readOnly = false);
            requestForm.reset();
        }

        // Set modal to view mode
        function setFormViewMode(request) {
            modalTitle.textContent = 'View Request Details';
            submitBtn.style.display = 'none';
            formInputs.forEach(input => input.readOnly = true);

            document.getElementById('name').value = request.name;
            document.getElementById('dateRequested').value = request.dateRequested;
            document.getElementById('requestedBy').value = request.requestedBy;
            document.getElementById('contactNumber').value = request.contactNumber;
            document.getElementById('purpose').value = request.purpose;
        }

        // Open modal when Add Request button is clicked
        addRequestBtn.addEventListener('click', function() {
            setFormAddMode();
            modal.classList.add('show');
        });

        // Close modal when close button or outside area is clicked
        closeBtn.addEventListener('click', function() {
            modal.classList.remove('show');
        });

        window.addEventListener('click', function(event) {
            if (event.target === modal) {
                modal.classList.remove('show');
            }
        });

        // Event listeners for filtering buttons
        filterButtons.forEach(button => {
            button.addEventListener('click', function() {
                filterButtons.forEach(btn => btn.classList.remove('active'));
                this.classList.add('active');
                
                const status = this.dataset.status;
                const filteredRequests = status === 'all' ? allRequests : allRequests.filter(r => r.status === status);
                renderTable(filteredRequests);
            });
        });

        // Search functionality
        searchInput.addEventListener('keyup', function() {
            const query = this.value.toLowerCase();
            const filteredRequests = allRequests.filter(request => 
                request.name.toLowerCase().includes(query) ||
                request.requestedBy.toLowerCase().includes(query)
            );
            renderTable(filteredRequests);
        });

        // Event listener for table actions (approve/reject/view)
        requestsTableBody.addEventListener('click', function(e) {
            const row = e.target.closest('tr');
            if (!row) return;

            const requestId = row.dataset.id;
            const requestIndex = allRequests.findIndex(r => r.id === requestId);
            let currentRequest = allRequests[requestIndex];
            
            if (e.target.closest('.approve-btn')) {
                currentRequest.status = 'approved';
                showAlert(`Ang request ni ${currentRequest.name} ay na-approve na!`, 'success');
            } else if (e.target.closest('.reject-btn')) {
                currentRequest.status = 'rejected';
                showAlert(`Ang request ni ${currentRequest.name} ay na-reject.`, 'error');
            } else if (e.target.closest('.release-btn')) {
                currentRequest.status = 'released';
                showAlert(`Ang certificate ni ${currentRequest.name} ay na-release na!`, 'info');
            } else if (e.target.closest('.reapprove-btn')) {
                currentRequest.status = 'approved';
                showAlert(`Ang request ni ${currentRequest.name} ay naibalik sa 'approved' status.`, 'warning');
            }
            
            // Re-render the table to show the updated status
            const activeFilter = document.querySelector('.filter-buttons .active').dataset.status;
            const filteredRequests = activeFilter === 'all' ? allRequests : allRequests.filter(r => r.status === activeFilter);
            renderTable(filteredRequests);

            // Open modal to view details if not an action button
            if (!e.target.closest('.action-buttons')) {
                setFormViewMode(currentRequest);
                modal.classList.add('show');
            }
        });

        // Initial render of the table
        renderTable(allRequests);
        
        // --- Sidebar dropdown functionality ---
        document.querySelectorAll('.nav-dropdown > a').forEach(dropdown => {
            dropdown.addEventListener('click', function(e) {
                e.preventDefault();
                const parentLi = this.parentElement;
                parentLi.classList.toggle('open');
            });
        });
    });
</script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
    document.addEventListener("DOMContentLoaded", () => {
        const logoutLink = document.getElementById("logoutLink");

        logoutLink.addEventListener("click", (e) => {
            e.preventDefault(); // Pipigilan nito ang default na behavior ng link (na mag-reload ng page)

            Swal.fire({
                title: 'Are you sure you want to log out?',
                text: "You will be redirected to the login page.",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Yes, log me out!'
            }).then((result) => {
                if (result.isConfirmed) {
                    // Dito mo ilalagay ang iyong actual logout logic, tulad ng:
                    // Removing user token or session data.
                    
                    // Pagkatapos ng logic, ire-redirect ang user sa login page.
                    window.location.href = "index.html";
                }
            });
        });
    });
</script>
</body>
</html>