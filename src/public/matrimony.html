<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Marriage Requests - San Jose Dashboard</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
<style>
/* CSS Code - Pinaikli pero complete functionality */
:root {
    --color-primary: #1B5E20;
    --color-primary-light: #2E7D32;
    --color-text-primary: #263238;
    --color-text-secondary: #546E7A;
    --color-background: #F8FDF8;
    --color-card-background: #ffffff;
    --color-border: #E8F5E9;
}

* { box-sizing: border-box; margin: 0; padding: 0; }

body {
    font-family: 'Inter', sans-serif;
    background-color: var(--color-background);
    color: var(--color-text-primary);
    line-height: 1.6;
}

.dashboard-container { 
    display: flex; 
    min-height: 100vh; 
    position: relative; /* Added for sidebar positioning */
}

/* Sidebar - FIXED */
.sidebar {
    width: 260px;
    background: linear-gradient(180deg, #2c3e50 0%, #1a2530 100%);
    color: #fff;
    transition: all 0.3s ease;
    position: relative; /* Added for toggle positioning */
    z-index: 1000; /* Ensure sidebar is above content */
}

.sidebar.collapsed { 
    width: 70px; 
}

.sidebar.collapsed .church-logo span,
.sidebar.collapsed .nav-links a span,
.sidebar.collapsed .dropdown-icon { 
    display: none; 
}

.sidebar.collapsed .nav-links a { 
    justify-content: center; 
    padding: 15px; 
}

.sidebar.collapsed .dropdown-menu { 
    display: none !important; 
}

.church-logo {
    display: flex;
    align-items: center;
    padding: 20px 15px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    position: relative; /* For toggle positioning */
}

.church-logo i { font-size: 24px; margin-right: 10px; color: #4CAF50; }
.church-logo span { font-weight: 700; font-size: 18px; }

.main-nav { padding: 15px 0; }
.nav-links { list-style: none; }
.nav-links li { position: relative; }

.nav-links a {
    display: flex;
    align-items: center;
    padding: 12px 20px;
    color: rgba(255, 255, 255, 0.8);
    text-decoration: none;
    transition: all 0.3s ease;
}

.nav-links a:hover { background-color: rgba(255, 255, 255, 0.05); color: #fff; padding-left: 25px; }
.nav-links a.active { background-color: rgba(76, 175, 80, 0.2); color: #4CAF50; border-left: 4px solid #4CAF50; }
.nav-links a i { margin-right: 12px; font-size: 18px; width: 20px; text-align: center; }

.nav-dropdown { position: relative; }
.dropdown-icon { margin-left: auto; transition: transform 0.3s ease; }
.nav-dropdown.open .dropdown-icon { transform: rotate(180deg); }

.dropdown-menu {
    list-style: none;
    background-color: rgba(0, 0, 0, 0.2);
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.4s ease;
}

.nav-dropdown.open .dropdown-menu { max-height: 300px; }
.dropdown-menu li a { padding-left: 50px; font-size: 14px; padding-top: 10px; padding-bottom: 10px; }
.dropdown-menu li a:hover { background-color: rgba(255, 255, 255, 0.05); }

.nav-logout { margin-top: 20px; border-top: 1px solid rgba(255, 255, 255, 0.1); }
.nav-logout a { color: #e74c3c; }
.nav-logout a:hover { background-color: rgba(231, 76, 60, 0.1); }

/* Sidebar Toggle - FIXED POSITION */
.sidebar-toggle {
    position: absolute;
    top: 20px;
    right: -12px; /* Adjusted to be properly positioned */
    background: #2c3e50;
    color: white;
    border: none;
    width: 24px;
    height: 24px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
    transition: all 0.3s ease;
    z-index: 1001; /* Higher than sidebar */
    font-size: 12px;
}

.sidebar-toggle:hover {
    background: #34495e;
    transform: scale(1.1);
}

/* Main Content */
.main-content { 
    flex: 1; 
    display: flex; 
    flex-direction: column; 
    transition: all 0.3s ease;
}

.header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px 30px;
    background-color: #fff;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
}

.search-bar {
    display: flex;
    align-items: center;
    background: #f5f7fb;
    border-radius: 20px;
    padding: 8px 15px;
    width: 300px;
}

.search-bar i { color: #7a7a7a; margin-right: 10px; }
.search-bar input { border: none; background: transparent; outline: none; width: 100%; }

.user-profile { display: flex; align-items: center; gap: 20px; }
.user-profile i { font-size: 20px; color: #7a7a7a; cursor: pointer; }
.user-profile i:hover { color: #4CAF50; }
.user-profile img { width: 40px; height: 40px; border-radius: 50%; object-fit: cover; }

/* Dashboard Widgets */
.dashboard-widgets {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
    padding: 25px 30px 0;
}

.widget-card {
    display: flex;
    align-items: center;
    padding: 20px;
    border-radius: 10px;
    color: white;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    transition: all 0.3s ease;
}

.widget-card:hover { transform: translateY(-5px); box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15); }
.widget-card i { font-size: 2.5rem; margin-right: 15px; }
.widget-content h4 { font-size: 14px; font-weight: 500; margin-bottom: 5px; opacity: 0.9; }
.widget-content p { font-size: 24px; font-weight: 700; }

.card-blue { background: linear-gradient(135deg, #3498db, #2980b9); }
.card-green { background: linear-gradient(135deg, #2ecc71, #27ae60); }
.card-purple { background: linear-gradient(135deg, #9b59b6, #8e44ad); }
.card-orange { background: linear-gradient(135deg, #e67e22, #d35400); }

/* Status Workflow */
.status-workflow {
    background: white;
    border-radius: 10px;
    padding: 20px;
    margin: 0 30px 20px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
}

.status-workflow h4 { margin-bottom: 15px; color: var(--color-primary); font-size: 1.1rem; }
.workflow-steps { display: flex; align-items: center; justify-content: center; flex-wrap: wrap; gap: 10px; }
.workflow-step { display: flex; flex-direction: column; align-items: center; gap: 8px; }

.step-icon {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.2rem;
    box-shadow: 0 4px 6px rgba(27, 94, 32, 0.08);
}

.step-icon.pending { background: #FFF9C4; color: #F57F17; }
.step-icon.in-process { background: #B3E5FC; color: #0288D1; }
.step-icon.scheduled { background: #E1BEE7; color: #7B1FA2; }
.step-icon.completed { background: #C8E6C9; color: #388E3C; }
.step-icon.approved { background: #BBDEFB; color: #1976D2; }

.step-label { font-size: 0.8rem; font-weight: 500; color: var(--color-text-secondary); }
.workflow-arrow { color: var(--color-text-secondary); }

/* Requests Section */
.requests-section { padding: 0 30px 30px; flex: 1; }
.box {
    background: white;
    border-radius: 10px;
    padding: 20px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
    transition: all 0.3s ease;
}

.box:hover { box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1); }
.box-title { font-size: 1.5rem; font-weight: 600; color: var(--color-primary); }

.table-header-controls {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
    flex-wrap: wrap;
    gap: 1rem;
}

.box-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 1rem;
    margin-bottom: 1rem;
}

.box-header .search-bar { flex-grow: 1; max-width: 300px; }
.table-actions { display: flex; align-items: center; gap: 1rem; }

.add-request-btn, .export-btn {
    display: flex;
    align-items: center;
    gap: 8px;
    color: #fff;
    border: none;
    padding: 12px 20px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
    transition: all 0.3s ease;
    box-shadow: 0 4px 6px rgba(27, 94, 32, 0.08);
}

.add-request-btn {
    background: linear-gradient(135deg, var(--color-primary), var(--color-primary-light));
}

.export-btn {
    background: linear-gradient(135deg, #FF9800, #F57C00);
}

.add-request-btn:hover, .export-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 24px rgba(27, 94, 32, 0.1); }

.filter-buttons { display: flex; flex-wrap: wrap; gap: 8px; }
.filter-buttons button {
    background: none;
    border: 1px solid var(--color-border);
    padding: 8px 15px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 500;
    color: var(--color-text-secondary);
    transition: all 0.3s ease;
    font-size: 0.85rem;
}

.filter-buttons button.active, .filter-buttons button:hover {
    background: linear-gradient(135deg, var(--color-primary), var(--color-primary-light));
    color: #fff;
    border-color: var(--color-primary);
    transform: translateY(-2px);
}

/* Table Styles */
.marriage-table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0 1rem;
}

.marriage-table thead th {
    color: var(--color-text-secondary);
    font-weight: 600;
    text-align: left;
    padding: 0.5rem 1rem;
    border-bottom: 2px solid var(--color-border);
}

.marriage-table tbody tr {
    background: var(--color-card-background);
    box-shadow: 0 4px 6px rgba(27, 94, 32, 0.08);
    border-radius: 8px;
    transition: all 0.3s ease;
    cursor: pointer;
}

.marriage-table tbody tr:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 24px rgba(27, 94, 32, 0.1);
    border-left: 5px solid var(--color-primary);
}

.marriage-table td { padding: 1rem; vertical-align: middle; }
.empty-state { text-align: center; color: var(--color-text-secondary); padding: 2rem; font-size: 1.1rem; display: none; }

/* Status Badges */
.status-badge, .payment-badge {
    display: inline-block;
    padding: 0.5rem 1rem;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 600;
    text-transform: uppercase;
}

.status-badge.pending { background-color: #FFF9C4; color: #F57F17; border: 1px solid #F57F17; }
.status-badge.in-process { background-color: #B3E5FC; color: #0288D1; border: 1px solid #0288D1; }
.status-badge.scheduled { background-color: #E1BEE7; color: #7B1FA2; border: 1px solid #7B1FA2; }
.status-badge.completed { background-color: #C8E6C9; color: #388E3C; border: 1px solid #388E3C; }
.status-badge.approved { background-color: #A5D6A7; color: #1B5E20; border: 1px solid #1B5E20; }
.status-badge.rejected { background-color: #FFCDD2; color: #C62828; border: 1px solid #C62828; }
.status-badge.cancelled { background-color: #F5F5F5; color: #616161; border: 1px solid #616161; }

.payment-badge.paid { background-color: #C8E6C9; color: #2E7D32; border: 1px solid #2E7D32; }
.payment-badge.pending { background-color: #FFF9C4; color: #F57F17; border: 1px solid #F57F17; }
.payment-badge.overdue { background-color: #FFCDD2; color: #C62828; border: 1px solid #C62828; }

/* Action Buttons */
.action-buttons { display: flex; gap: 0.5rem; flex-wrap: wrap; }
.action-buttons button {
    border: none;
    padding: 0.5rem 0.8rem;
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 0.8rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 4px;
    box-shadow: 0 4px 6px rgba(27, 94, 32, 0.08);
    color: #fff;
}

.action-buttons .process-btn { background: linear-gradient(135deg, #0288D1, #03A9F4); }
.action-buttons .schedule-btn { background: linear-gradient(135deg, #7B1FA2, #9C27B0); }
.action-buttons .complete-btn { background: linear-gradient(135deg, #388E3C, #4CAF50); }
.action-buttons .approve-btn { background: linear-gradient(135deg, #1b5e20, #388E3C); }
.action-buttons .reject-btn { background: linear-gradient(135deg, #c62828, #EF5350); }
.action-buttons .cancel-btn { background: linear-gradient(135deg, #616161, #9E9E9E); }
.action-buttons .reset-btn { background: linear-gradient(135deg, #FFA000, #FFB300); }
.action-buttons .payment-btn { background: linear-gradient(135deg, #FF6F00, #FF8F00); }
.action-buttons .export-individual-btn { background: linear-gradient(135deg, #9C27B0, #7B1FA2); }

.action-buttons button:hover { transform: translateY(-2px); box-shadow: 0 8px 24px rgba(27, 94, 32, 0.1); }
.action-buttons button:disabled { background: #e0e0e0; color: #9e9e9e; cursor: not-allowed; transform: none; box-shadow: none; }

/* Modal Styles */
.modal {
    display: none;
    position: fixed;
    z-index: 1100; /* Higher than sidebar */
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0,0,0,0.6);
}

.modal.show { display: block; }

.modal-content {
    background-color: #fefefe;
    margin: 5% auto;
    padding: 20px;
    border: 1px solid #888;
    width: 80%;
    max-width: 800px;
    border-radius: 12px;
    position: relative;
    box-shadow: 0 12px 32px rgba(27, 94, 32, 0.15);
    max-height: 90vh;
    overflow-y: auto;
}

.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid var(--color-border);
    padding-bottom: 10px;
    margin-bottom: 15px;
}

.modal .close-btn {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
    transition: color 0.2s ease;
}

.modal .close-btn:hover { color: var(--color-primary); }

.form-group { margin-bottom: 1rem; }
.form-row { display: grid; grid-template-columns: 1fr; gap: 0.5rem; }

@media (min-width: 768px) {
    .form-row.double { grid-template-columns: 1fr 1fr; }
    .form-row.triple { grid-template-columns: repeat(3, 1fr); }
}

.form-group label { display: block; font-weight: 600; margin-bottom: 0.5rem; color: var(--color-text-primary); font-size: 0.9rem; }
.form-group input, .form-group textarea, .form-group select {
    width: 100%;
    padding: 10px 12px;
    border: 1px solid var(--color-border);
    border-radius: 8px;
    font-family: inherit;
    font-size: 0.9rem;
    transition: all 0.2s ease;
}

.form-group input:focus, .form-group textarea:focus, .form-group select:focus {
    outline: none;
    border-color: var(--color-primary);
    box-shadow: 0 0 0 2px rgba(46, 125, 50, 0.2);
}

.submit-btn {
    width: 100%;
    background: linear-gradient(135deg, var(--color-primary), var(--color-primary-light));
    color: white;
    padding: 12px 15px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-size: 0.9rem;
    font-weight: 600;
    transition: all 0.3s ease;
    box-shadow: 0 4px 6px rgba(27, 94, 32, 0.08);
}

.submit-btn:hover {
    background: linear-gradient(135deg, var(--color-primary-light), var(--color-primary));
    transform: translateY(-2px);
    box-shadow: 0 8px 24px rgba(27, 94, 32, 0.1);
}

.custom-alert-container {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 1200; /* Highest z-index */
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.custom-alert {
    padding: 15px 25px;
    border-radius: 8px;
    color: white;
    font-weight: 600;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    display: flex;
    align-items: center;
    gap: 15px;
    transition: all 0.3s ease-in-out;
}

.custom-alert.success { background: linear-gradient(135deg, var(--color-primary), var(--color-primary-light)); }
.custom-alert.error { background: linear-gradient(135deg, #D32F2F, #E53935); }
.custom-alert .close-notif { background: none; border: none; color: white; font-size: 1.2rem; cursor: pointer; }
.custom-alert .close-notif:hover { transform: scale(1.2); }
.custom-alert.hide { opacity: 0; transform: translateX(100%); }

.form-section-header {
    font-size: 1.1rem;
    font-weight: 700;
    color: var(--color-primary);
    border-bottom: 2px solid var(--color-primary);
    padding-bottom: 0.5rem;
    margin-bottom: 1rem;
}

/* Details Modal Styles */
.details-section { margin-bottom: 1.5rem; }
.details-section-header {
    font-size: 1.1rem;
    font-weight: 700;
    color: var(--color-primary);
    border-bottom: 1px solid var(--color-border);
    padding-bottom: 0.5rem;
    margin-bottom: 1rem;
}

.details-grid { display: grid; grid-template-columns: 1fr; gap: 1rem; }
@media (min-width: 768px) { .details-grid { grid-template-columns: 1fr 1fr; } }

.detail-item { display: flex; flex-direction: column; gap: 5px; }
.detail-item.full-width { grid-column: 1 / -1; }
.detail-label { font-weight: 600; color: var(--color-text-secondary); font-size: 0.9rem; }
.detail-value { padding: 8px 12px; background: #f8f9fa; border-radius: 8px; border: 1px solid var(--color-border); font-size: 0.9rem; }
.detail-textarea { padding: 8px 12px; background: #f8f9fa; border-radius: 8px; border: 1px solid var(--color-border); min-height: 80px; font-size: 0.9rem; white-space: pre-wrap; }

/* Responsive Design */
@media (max-width: 992px) {
    .sidebar { 
        position: fixed; 
        height: 100vh; 
        z-index: 1000; 
    }
    
    .sidebar.collapsed { 
        width: 70px; 
    }
    
    .sidebar .church-logo span, 
    .sidebar .nav-links a span, 
    .sidebar .dropdown-icon { 
        display: none; 
    }
    
    .sidebar .nav-links a { 
        justify-content: center; 
        padding: 15px; 
    }
    
    .sidebar .dropdown-menu { 
        display: none !important; 
    }
    
    .main-content {
        margin-left: 70px; /* Account for collapsed sidebar */
    }
}

@media (max-width: 768px) {
    .dashboard-widgets { grid-template-columns: 1fr; }
    .header { flex-direction: column; gap: 15px; }
    .search-bar { width: 100%; }
    .action-buttons { flex-direction: column; }
    .action-buttons button { width: 100%; justify-content: center; }
    .table-header-controls, .box-header { flex-direction: column; align-items: flex-start; }
    .box-header .search-bar, .filter-buttons { width: 100%; }
    .modal-content { width: 95%; margin: 10% auto; }
    .workflow-steps { flex-direction: column; align-items: flex-start; }
    .workflow-arrow { transform: rotate(90deg); margin: 5px 0; }
    
    .sidebar {
        width: 100%;
        transform: translateX(-100%);
    }
    
    .sidebar.show {
        transform: translateX(0);
    }
    
    .main-content {
        margin-left: 0;
    }
}
</style>
</head>
<body>
<div class="dashboard-container">
  <aside class="sidebar">
    <button class="sidebar-toggle"><i class="fas fa-bars"></i></button>
    <div class="church-logo">
      <i class="fa-solid fa-church"></i>
      <span>SJMP ADMIN</span>
    </div>
    <nav class="main-nav">
      <ul class="nav-links">
        <li><a href="dashboard.html"><i class="fa-solid fa-house-chimney"></i><span>Dashboard</span></a></li>
        <li class="nav-dropdown open">
          <a href="#"><i class="fa-solid fa-cross"></i><span>7 Sacraments</span><i class="fa-solid fa-chevron-down dropdown-icon"></i></a>
           <ul class="dropdown-menu">
            <li><a href="baptism.html"><span>Baptism</span></a></li>
            <li><a href="kumpil.html"><span>Confirmation</span></a></li>
            <li><a href="anointing.html"><span>Anointing of the Sick</span></a></li>
            <li><a href="holy-orders.html"><span>Holy Orders</span></a></li>
            <li><a href="matrimony.html"><span>Matrimony</span></a></li>
          </ul>
        </li>
        <li class="nav-dropdown open">
          <a href="#"><i class="fa-solid fa-cross"></i><span>Other Services</span><i class="fa-solid fa-chevron-down dropdown-icon"></i></a>
          <ul class="dropdown-menu">
            <li><a href="pamisa.html"><span>Pamisa</span></a></li>
            <li><a href="blessing.html"><span>Blessing</span></a></li>
            <li><a href="pamisapatay.html"><span>Pamisa sa patay</span></a></li>
          </ul> 
        </li>
        <li><a href="usermanage.html"><i class="fa-solid fa-user-gear"></i><span>User Management</span></a></li>
        <li><a href="schedule.html"><i class="fa-solid fa-calendar-alt"></i><span>Schedule</span></a></li>
        <li><a href="certificate.html"><i class="fa-solid fa-globe"></i><span>Certificate Request</span></a></li>
        <li><a href="report.html"><i class="fa-solid fa-globe"></i><span>Reports And Analytics</span></a></li>
        <li><a href="volunteer.html"><i class="fa-solid fa-hands-helping"></i><span>Volunteer Applications</span></a></li>
        <li class="nav-logout"><a href="#" id="logoutLink"><i class="fa-solid fa-right-from-bracket"></i><span>Logout</span></a></li>
      </ul>
    </nav>
  </aside>
  
  <main class="main-content">
    <header class="header">
      <div class="search-bar">
        <i class="fa-solid fa-magnifying-glass"></i>
        <input type="text" id="headerSearch" placeholder="Search for a request...">
      </div>
      <div class="user-profile">
        <i class="fa-solid fa-bell"></i>
        <i class="fa-solid fa-comment-dots"></i>
        <img src="../images/LOGO.png" alt="User Profile">
      </div>
    </header>

    <div class="dashboard-widgets">
      <div class="widget-card card-blue">
        <i class="fa-solid fa-list-check"></i>
        <div class="widget-content">
          <h4>Total Requests</h4>
          <p id="totalRequests">0</p>
        </div>
      </div>
      <div class="widget-card card-green">
        <i class="fa-solid fa-calendar-days"></i>
        <div class="widget-content">
          <h4>Upcoming Weddings</h4>
          <p id="upcomingCount">0</p>
        </div>
      </div>
      <div class="widget-card card-purple">
        <i class="fa-solid fa-clock"></i>
        <div class="widget-content">
          <h4>Pending</h4>
          <p id="pendingCount">0</p>
        </div>
      </div>
      <div class="widget-card card-orange">
        <i class="fa-solid fa-check-circle"></i>
        <div class="widget-content">
          <h4>Completed</h4>
          <p id="completedCount">0</p>
        </div>
      </div>
    </div>

    <div class="status-workflow">
      <h4>Marriage Request Workflow</h4>
      <div class="workflow-steps">
        <div class="workflow-step">
          <div class="step-icon pending"><i class="fa-solid fa-clock"></i></div>
          <div class="step-label">Pending</div>
        </div>
        <div class="workflow-arrow"><i class="fa-solid fa-arrow-right"></i></div>
        <div class="workflow-step">
          <div class="step-icon in-process"><i class="fa-solid fa-gears"></i></div>
          <div class="step-label">In Process</div>
        </div>
        <div class="workflow-arrow"><i class="fa-solid fa-arrow-right"></i></div>
        <div class="workflow-step">
          <div class="step-icon scheduled"><i class="fa-solid fa-calendar-check"></i></div>
          <div class="step-label">Scheduled</div>
        </div>
        <div class="workflow-arrow"><i class="fa-solid fa-arrow-right"></i></div>
        <div class="workflow-step">
          <div class="step-icon completed"><i class="fa-solid fa-check-circle"></i></div>
          <div class="step-label">Completed</div>
        </div>
        <div class="workflow-arrow"><i class="fa-solid fa-arrow-right"></i></div>
        <div class="workflow-step">
          <div class="step-icon approved"><i class="fa-solid fa-thumbs-up"></i></div>
          <div class="step-label">Approved</div>
        </div>
      </div>
    </div>

    <section class="requests-section">
      <div class="box">
        <div class="box-header">
          <h3 class="box-title">All Marriage Requests</h3>
          <div class="search-bar">
            <i class="fa-solid fa-magnifying-glass"></i>
            <input type="text" id="tableSearch" placeholder="Search for a request...">
          </div>
        </div>
        <div class="table-header-controls">
          <div class="table-actions">
            <button class="add-request-btn" id="addRequestBtn">
              <i class="fa-solid fa-plus"></i> Add Request
            </button>
            <button class="export-btn" id="exportBtn">
              <i class="fa-solid fa-file-export"></i> Export Data
            </button>
            <div class="filter-buttons">
              <button class="active" data-status="all">All</button>
              <button data-status="pending">Pending</button>
              <button data-status="in-process">In Process</button>
              <button data-status="scheduled">Scheduled</button>
              <button data-status="completed">Completed</button>
              <button data-status="approved">Approved</button>
              <button data-status="rejected">Rejected</button>
              <button data-status="cancelled">Cancelled</button>
            </div>
          </div>
        </div>
        <div class="table-container">
          <table class="marriage-table" id="requestsTable">
            <thead>
              <tr>
                <th>Couple</th>
                <th>Wedding Date</th>
                <th>Wedding Time</th>
                <th>Groom Contact</th>
                <th>Bride Contact</th>
                <th>Status</th>
                <th>Payment</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
          <div class="empty-state" id="emptyState">No marriage requests found.</div>
        </div>
      </div>
    </section>
  </main>
</div>

<!-- Add Request Modal -->
<div id="addRequestModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h2>Add Marriage Request</h2>
      <span class="close-btn">&times;</span>
    </div>
    <form id="addRequestForm">
      <h3 class="form-section-header">Wedding Details</h3>
      <div class="form-row double">
        <div class="form-group">
          <label for="dateOfWedding">Wedding Date:</label>
          <input type="date" id="dateOfWedding" required>
        </div>
        <div class="form-group">
          <label for="timeOfWedding">Wedding Time:</label>
          <input type="time" id="timeOfWedding" required>
        </div>
      </div>

      <h3 class="form-section-header">Groom Information</h3>
      <div class="form-row triple">
        <div class="form-group">
          <label for="groomName">First Name:</label>
          <input type="text" id="groomName" required>
        </div>
        <div class="form-group">
          <label for="groomMiddleName">Middle Name:</label>
          <input type="text" id="groomMiddleName" required>
        </div>
        <div class="form-group">
          <label for="groomSurname">Surname:</label>
          <input type="text" id="groomSurname" required>
        </div>
      </div>
      <div class="form-row double">
        <div class="form-group">
          <label for="groomDOB">Date of Birth:</label>
          <input type="date" id="groomDOB" required>
        </div>
        <div class="form-group">
          <label for="groomAge">Age:</label>
          <input type="number" id="groomAge" required>
        </div>
      </div>
      <div class="form-group">
        <label for="groomPOB">Place of Birth:</label>
        <input type="text" id="groomPOB" required>
      </div>
      <div class="form-group">
        <label for="groomResidence">Residence:</label>
        <input type="text" id="groomResidence" required>
      </div>
      <div class="form-row double">
        <div class="form-group">
          <label for="groomFatherName">Father's Name:</label>
          <input type="text" id="groomFatherName" required>
        </div>
        <div class="form-group">
          <label for="groomMotherMaidenName">Mother's Maiden Name:</label>
          <input type="text" id="groomMotherMaidenName" required>
        </div>
      </div>
      <div class="form-group">
        <label for="groomCP">Contact Number:</label>
        <input type="tel" id="groomCP" required>
      </div>

      <h3 class="form-section-header">Bride Information</h3>
      <div class="form-row triple">
        <div class="form-group">
          <label for="brideName">First Name:</label>
          <input type="text" id="brideName" required>
        </div>
        <div class="form-group">
          <label for="brideMiddleName">Middle Name:</label>
          <input type="text" id="brideMiddleName" required>
        </div>
        <div class="form-group">
          <label for="brideSurname">Surname:</label>
          <input type="text" id="brideSurname" required>
        </div>
      </div>
      <div class="form-row double">
        <div class="form-group">
          <label for="brideDOB">Date of Birth:</label>
          <input type="date" id="brideDOB" required>
        </div>
        <div class="form-group">
          <label for="brideAge">Age:</label>
          <input type="number" id="brideAge" required>
        </div>
      </div>
      <div class="form-group">
        <label for="bridePOB">Place of Birth:</label>
        <input type="text" id="bridePOB" required>
      </div>
      <div class="form-group">
        <label for="brideResidence">Residence:</label>
        <input type="text" id="brideResidence" required>
      </div>
      <div class="form-row double">
        <div class="form-group">
          <label for="brideFatherName">Father's Name:</label>
          <input type="text" id="brideFatherName" required>
        </div>
        <div class="form-group">
          <label for="brideMotherMaidenName">Mother's Maiden Name:</label>
          <input type="text" id="brideMotherMaidenName" required>
        </div>
      </div>
      <div class="form-group">
        <label for="brideCP">Contact Number:</label>
        <input type="tel" id="brideCP" required>
      </div>

      <h3 class="form-section-header">Required Documents</h3>
      <div class="form-row double">
        <div class="form-group">
          <label for="groomMarriageLicense">Groom's Marriage License:</label>
          <input type="text" id="groomMarriageLicense">
        </div>
        <div class="form-group">
          <label for="brideMarriageLicense">Bride's Marriage License:</label>
          <input type="text" id="brideMarriageLicense">
        </div>
      </div>
      <div class="form-row double">
        <div class="form-group">
          <label for="groomBaptismalCert">Groom's Baptismal Certificate:</label>
          <input type="text" id="groomBaptismalCert">
        </div>
        <div class="form-group">
          <label for="brideBaptismalCert">Bride's Baptismal Certificate:</label>
          <input type="text" id="brideBaptismalCert">
        </div>
      </div>

      <h3 class="form-section-header">Schedule</h3>
      <div class="form-row double">
        <div class="form-group">
          <label for="interviewDate">Interview Date:</label>
          <input type="date" id="interviewDate">
        </div>
        <div class="form-group">
          <label for="interviewTime">Interview Time:</label>
          <input type="time" id="interviewTime">
        </div>
      </div>
      <div class="form-row double">
        <div class="form-group">
          <label for="seminarDate">Seminar Date:</label>
          <input type="date" id="seminarDate">
        </div>
        <div class="form-group">
          <label for="seminarTime">Seminar Time:</label>
          <input type="time" id="seminarTime">
        </div>
      </div>

      <h3 class="form-section-header">Sponsors (Optional)</h3>
      <div class="form-group">
        <label for="sponsors">Sponsors (comma separated):</label>
        <textarea id="sponsors" placeholder="Enter sponsor names separated by commas"></textarea>
      </div>

      <button type="submit" class="submit-btn" id="submitAddBtn">Add Request</button>
    </form>
  </div>
</div>

<!-- Details Modal -->
<div id="detailsModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h2>Marriage Request Details</h2>
      <span class="close-btn" id="closeDetails">&times;</span>
    </div>
    <div class="modal-body" id="detailsContent"></div>
    <div class="modal-footer" style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 20px; padding-top: 15px; border-top: 1px solid var(--color-border);">
      <button class="export-individual-btn" id="exportIndividualBtn">
        <i class="fa-solid fa-file-export"></i> Export This Request
      </button>
    </div>
  </div>
</div>

<!-- Export Modal -->
<div id="exportModal" class="modal export-modal">
  <div class="modal-content">
    <div class="modal-header">
      <h2>Export Marriage Data</h2>
      <span class="close-btn" id="closeExport">&times;</span>
    </div>
    <div class="export-options" id="exportOptions">
      <div class="export-option" data-format="pdf">
        <input type="radio" name="exportFormat" id="pdfFormat" value="pdf" checked>
        <div class="export-option-label">
          <h4>PDF Format (Bond Paper/A4)</h4>
          <p>Export data as PDF file. Best for printing and sharing.</p>
        </div>
      </div>
    </div>
    <div class="form-group">
      <label for="exportRange">Export Range:</label>
      <select id="exportRange">
        <option value="current">Current View (Filtered Data)</option>
        <option value="all">All Data</option>
      </select>
    </div>
    <button type="button" class="submit-btn" id="submitExportBtn">Export Data</button>
  </div>
</div>

<div id="alertContainer" class="custom-alert-container"></div>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Sidebar toggle functionality - FIXED
    const sidebarToggle = document.querySelector('.sidebar-toggle');
    const sidebar = document.querySelector('.sidebar');
    
    sidebarToggle.addEventListener('click', function() {
        sidebar.classList.toggle('collapsed');
        // Toggle between bars and times icon
        const icon = this.querySelector('i');
        if (icon.classList.contains('fa-bars')) {
            icon.classList.remove('fa-bars');
            icon.classList.add('fa-times');
        } else {
            icon.classList.remove('fa-times');
            icon.classList.add('fa-bars');
        }
    });

    // Dropdown functionality
    document.querySelectorAll('.nav-dropdown > a').forEach(function(dropdown) {
        dropdown.addEventListener('click', function(e) {
            e.preventDefault();
            const parent = this.parentElement;
            parent.classList.toggle('open');
        });
    });

    const baseURL = "https://sjmpadmin.onrender.com/api/marriage";
    const addRequestBtn = document.getElementById('addRequestBtn');
    const exportBtn = document.getElementById('exportBtn');
    const exportIndividualBtn = document.getElementById('exportIndividualBtn');
    const modal = document.getElementById('addRequestModal');
    const exportModal = document.getElementById('exportModal');
    const closeBtn = document.querySelector('.modal .close-btn');
    const closeExport = document.getElementById('closeExport');
    const addRequestForm = document.getElementById('addRequestForm');
    const requestsTableBody = document.querySelector('#requestsTable tbody');
    const emptyState = document.getElementById('emptyState');
    const filterButtons = document.querySelectorAll('.filter-buttons button');
    const totalRequestsCount = document.getElementById('totalRequests');
    const pendingCount = document.getElementById('pendingCount');
    const upcomingCount = document.getElementById('upcomingCount');
    const completedCount = document.getElementById('completedCount');
    const headerSearchInput = document.getElementById('headerSearch');
    const tableSearchInput = document.getElementById('tableSearch');

    const detailsModal = document.getElementById('detailsModal');
    const closeDetails = document.getElementById('closeDetails');
    const detailsContent = document.getElementById('detailsContent');

    let requests = [];
    let currentFilter = 'all';
    let currentSearchTerm = '';
    let currentFilteredData = [];
    let currentDetailsRequest = null;

    // Define status workflow
    const statusWorkflow = {
        'pending': ['in-process', 'rejected', 'cancelled'],
        'in-process': ['scheduled', 'rejected', 'cancelled'],
        'scheduled': ['completed', 'cancelled'],
        'completed': ['approved', 'rejected'],
        'approved': [],
        'rejected': ['pending'],
        'cancelled': ['pending']
    };

    // Date formatting functions
    function formatDate(dateString) {
        if (!dateString) return 'N/A';
        try {
            let date;
            if (dateString.includes('/')) {
                const [month, day, year] = dateString.split('/');
                date = new Date(year, month - 1, day);
            } else {
                date = new Date(dateString);
            }
            
            if (isNaN(date.getTime())) return dateString;
            
            return date.toLocaleDateString('en-PH', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });
        } catch (e) {
            return dateString;
        }
    }

    function formatTime(timeString) {
        if (!timeString) return 'N/A';
        return timeString;
    }

    function getPaymentStatusClass(paymentStatus) {
        switch(paymentStatus) {
            case 'paid': return 'paid';
            case 'pending': return 'pending';
            case 'overdue': return 'overdue';
            default: return 'pending';
        }
    }

    // Function to display value or N/A if empty
    function displayValue(value) {
        if (!value || value === '' || value === '0' || value === 0) {
            return 'N/A';
        }
        return value;
    }

    // Transform data to match what frontend expects
    function transformMarriageData(data) {
        return data.map(request => {
            return {
                _id: request._id || '',
                sacrament: request.sacrament || '',
                dateOfWedding: request.dateOfWedding || '',
                timeOfWedding: request.timeOfWedding || '',
                groomName: request.groomName || '',
                groomMiddleName: request.groomMiddleName || '',
                groomSurname: request.groomSurname || '',
                groomDOB: request.groomDOB || '',
                groomAge: request.groomAge || '',
                groomPOB: request.groomPOB || '',
                groomResidence: request.groomResidence || '',
                groomFatherName: request.groomFatherName || '',
                groomMotherMaidenName: request.groomMotherMaidenName || '',
                groomCP: request.groomCP || '',
                brideName: request.brideName || '',
                brideMiddleName: request.brideMiddleName || '',
                brideSurname: request.brideSurname || '',
                brideDOB: request.brideDOB || '',
                brideAge: request.brideAge || '',
                bridePOB: request.bridePOB || '',
                brideResidence: request.brideResidence || '',
                brideFatherName: request.brideFatherName || '',
                brideMotherMaidenName: request.brideMotherMaidenName || '',
                brideCP: request.brideCP || '',
                groomMarriageLicense: request.groomMarriageLicense || '',
                groomBaptismalCert: request.groomBaptismalCert || '',
                groomConfirmationCert: request.groomConfirmationCert || '',
                groomMarriageBannsPermission: request.groomMarriageBannsPermission || '',
                brideMarriageLicense: request.brideMarriageLicense || '',
                brideBaptismalCert: request.brideBaptismalCert || '',
                brideConfirmationCert: request.brideConfirmationCert || '',
                brideMarriageBannsPermission: request.brideMarriageBannsPermission || '',
                interviewDate: request.interviewDate || '',
                interviewTime: request.interviewTime || '',
                seminarDate: request.seminarDate || '',
                seminarTime: request.seminarTime || '',
                sponsors: request.sponsors || [],
                groomSignature: request.groomSignature || '',
                brideSignature: request.brideSignature || '',
                status: request.status || 'pending',
                paymentStatus: request.paymentStatus || 'pending',
                fee: request.fee || 5000,
                submittedByEmail: request.submittedByEmail || '',
                requestNumber: request.requestNumber || '',
                createdAt: request.createdAt || '',
                lastUpdated: request.lastUpdated || '',
                
                // For frontend display
                coupleName: `${request.groomName || ''} ${request.groomSurname || ''} & ${request.brideName || ''} ${request.brideSurname || ''}`,
                weddingDate: request.dateOfWedding || '',
                weddingTime: request.timeOfWedding || '',
                groomContact: request.groomCP || 'N/A',
                brideContact: request.brideCP || 'N/A',
                
                // Payment fields
                paymentDate: request.paymentDate || '',
                paymentMethod: request.paymentMethod || '',
                paymentReference: request.paymentReference || '',
                paymentNotes: request.paymentNotes || ''
            };
        });
    }

    async function fetchRequests() {
        try {
            console.log("ðŸ”„ Fetching marriage requests from:", baseURL);
            const res = await fetch(baseURL);
            
            if (!res.ok) {
                throw new Error(`HTTP error! status: ${res.status}`);
            }
            
            const data = await res.json();
            requests = transformMarriageData(data);
            
            console.log("âœ… Fetched marriage requests:", requests);
            applyFiltersAndSearch();
        } catch (err) { 
            console.error("âŒ Failed to fetch requests:", err);
            showNotification('Failed to fetch requests from server. Make sure the server is running on port 5000.', 'error');
        }
    }

    async function addRequest(request) {
        try {
            const res = await fetch(baseURL, {
                method: 'POST', 
                headers: {'Content-Type': 'application/json'}, 
                body: JSON.stringify(request)
            });
            
            if (!res.ok) {
                throw new Error(`HTTP error! status: ${res.status}`);
            }
            
            const result = await res.json();
            console.log("âœ… Added request:", result);
            showNotification('New marriage request added successfully!');
            fetchRequests();
        } catch (err) {
            console.error("âŒ Failed to add request:", err);
            showNotification('Failed to add request. ' + err.message, 'error');
        }
    }

    async function updateRequestStatus(id, status) {
        try {
            const updateData = { status };
            
            console.log("ðŸ”„ Updating request:", updateData);
            const res = await fetch(`${baseURL}/${id}`, {
                method: 'PUT', 
                headers: {'Content-Type': 'application/json'}, 
                body: JSON.stringify(updateData)
            });
            
            if (!res.ok) {
                throw new Error(`HTTP error! status: ${res.status}`);
            }
            
            const result = await res.json();
            console.log("âœ… Update result:", result);
            showNotification(`Request status updated to ${status}!`);
            fetchRequests();
        } catch (err) {
            console.error("âŒ Failed to update request:", err);
            showNotification('Failed to update request. ' + err.message, 'error');
        }
    }

    function getAvailableActions(currentStatus) {
        return statusWorkflow[currentStatus] || [];
    }

    function applyFiltersAndSearch() {
        let filteredData = [...requests];
        
        if (currentFilter !== 'all') {
            filteredData = filteredData.filter(r => r.status === currentFilter);
        }
        
        if (currentSearchTerm) {
            const term = currentSearchTerm.toLowerCase();
            filteredData = filteredData.filter(r => 
                r.coupleName.toLowerCase().includes(term) || 
                (r.groomContact && r.groomContact.toLowerCase().includes(term)) ||
                (r.brideContact && r.brideContact.toLowerCase().includes(term)) ||
                (r.status && r.status.toLowerCase().includes(term)) ||
                (r.requestNumber && r.requestNumber.toLowerCase().includes(term))
            );
        }
        
        currentFilteredData = filteredData;
        renderTable(filteredData);
    }

    function renderTable(data) {
        requestsTableBody.innerHTML = '';
        if(data.length === 0){ 
            emptyState.style.display = 'block'; 
        } else {
            emptyState.style.display = 'none';
            data.forEach(request => {
                const row = document.createElement('tr');
                row.dataset.id = request._id;
                const availableActions = getAvailableActions(request.status);
                
                const paymentStatus = request.paymentStatus || 'pending';
                
                row.innerHTML = `
                    <td>${request.coupleName}</td>
                    <td>${formatDate(request.weddingDate)}</td>
                    <td>${formatTime(request.weddingTime)}</td>
                    <td>${request.groomContact}</td>
                    <td>${request.brideContact}</td>
                    <td><span class="status-badge ${request.status}">${request.status}</span></td>
                    <td><span class="payment-badge ${getPaymentStatusClass(paymentStatus)}">${paymentStatus}</span></td>
                    <td>
                        <div class="action-buttons">
                            ${availableActions.includes('in-process') ? 
                                `<button class="process-btn" title="Mark as In Process">
                                    <i class="fa-solid fa-gears"></i> Process
                                </button>` : ''}
                            ${availableActions.includes('scheduled') ? 
                                `<button class="schedule-btn" title="Mark as Scheduled">
                                    <i class="fa-solid fa-calendar-check"></i> Schedule
                                </button>` : ''}
                            ${availableActions.includes('completed') ? 
                                `<button class="complete-btn" title="Mark as Completed">
                                    <i class="fa-solid fa-check-circle"></i> Complete
                                </button>` : ''}
                            ${availableActions.includes('approved') ? 
                                `<button class="approve-btn" title="Approve">
                                    <i class="fa-solid fa-thumbs-up"></i> Approve
                                </button>` : ''}
                            ${availableActions.includes('rejected') ? 
                                `<button class="reject-btn" title="Reject">
                                    <i class="fa-solid fa-ban"></i> Reject
                                </button>` : ''}
                            ${availableActions.includes('cancelled') ? 
                                `<button class="cancel-btn" title="Cancel">
                                    <i class="fa-solid fa-xmark"></i> Cancel
                                </button>` : ''}
                            ${availableActions.includes('pending') ? 
                                `<button class="reset-btn" title="Reset to Pending">
                                    <i class="fa-solid fa-rotate-left"></i> Reset
                                </button>` : ''}
                            <button class="payment-btn" title="Update Payment">
                                <i class="fa-solid fa-money-bill"></i> Payment
                            </button>
                            <button class="export-individual-btn" title="Export Individual Request">
                                <i class="fa-solid fa-file-export"></i> Export
                            </button>
                        </div>
                    </td>
                `;
                requestsTableBody.appendChild(row);
            });
        }
        updateCounts(data);
    }

    function updateCounts(data){
        totalRequestsCount.textContent = data.length;
        pendingCount.textContent = data.filter(r => r.status === 'pending').length;
        
        const today = new Date();
        today.setHours(0, 0, 0, 0); 
        upcomingCount.textContent = data.filter(r => {
            if (!r.weddingDate) return false;
            try {
                let weddingDate;
                if (r.weddingDate.includes('/')) {
                    const [month, day, year] = r.weddingDate.split('/');
                    weddingDate = new Date(year, month - 1, day);
                } else {
                    weddingDate = new Date(r.weddingDate);
                }
                weddingDate.setHours(0, 0, 0, 0);
                return weddingDate >= today && (r.status === 'scheduled' || r.status === 'in-process');
            } catch (e) {
                return false;
            }
        }).length;
        
        completedCount.textContent = data.filter(r => r.status === 'completed').length;
    }

    function showNotification(message, type = 'success'){
        const alert = document.createElement('div');
        alert.className = `custom-alert ${type}`;
        alert.innerHTML = `<span>${message}</span><button class="close-notif">&times;</button>`;
        document.getElementById('alertContainer').appendChild(alert);
        setTimeout(()=>{
            alert.classList.add('hide'); 
            setTimeout(() => alert.remove(), 300);
        }, 5000);
        alert.querySelector('.close-notif').addEventListener('click',()=>alert.remove());
    }

    // Modal handling
    addRequestBtn.addEventListener('click', ()=>modal.classList.add('show'));
    exportBtn.addEventListener('click', ()=>exportModal.classList.add('show'));
    closeBtn.addEventListener('click', ()=>{
        modal.classList.remove('show'); 
        addRequestForm.reset();
    });
    closeExport.addEventListener('click', ()=>{
        exportModal.classList.remove('show');
    });
    window.addEventListener('click', (e)=>{
        if(e.target===modal){
            modal.classList.remove('show'); 
            addRequestForm.reset();
        }
        if(e.target===exportModal){
            exportModal.classList.remove('show');
        }
    });

    // Form submission
    addRequestForm.addEventListener('submit', (e)=>{
        e.preventDefault();
        
        const timestamp = Date.now();
        const randomString = Math.random().toString(36).substring(2, 10);
        const requestNumber = `MARRIAGE-${timestamp}-${randomString}`;
        
        // Process sponsors
        const sponsorsInput = document.getElementById('sponsors').value;
        const sponsors = sponsorsInput ? sponsorsInput.split(',').map(s => s.trim()).filter(s => s !== '') : [];
        
        const newRequest = {
            dateOfWedding: document.getElementById('dateOfWedding').value,
            timeOfWedding: document.getElementById('timeOfWedding').value,
            // Groom Information
            groomName: document.getElementById('groomName').value,
            groomMiddleName: document.getElementById('groomMiddleName').value,
            groomSurname: document.getElementById('groomSurname').value,
            groomDOB: document.getElementById('groomDOB').value,
            groomAge: document.getElementById('groomAge').value,
            groomPOB: document.getElementById('groomPOB').value,
            groomResidence: document.getElementById('groomResidence').value,
            groomFatherName: document.getElementById('groomFatherName').value,
            groomMotherMaidenName: document.getElementById('groomMotherMaidenName').value,
            groomCP: document.getElementById('groomCP').value,
            // Bride Information
            brideName: document.getElementById('brideName').value,
            brideMiddleName: document.getElementById('brideMiddleName').value,
            brideSurname: document.getElementById('brideSurname').value,
            brideDOB: document.getElementById('brideDOB').value,
            brideAge: document.getElementById('brideAge').value,
            bridePOB: document.getElementById('bridePOB').value,
            brideResidence: document.getElementById('brideResidence').value,
            brideFatherName: document.getElementById('brideFatherName').value,
            brideMotherMaidenName: document.getElementById('brideMotherMaidenName').value,
            brideCP: document.getElementById('brideCP').value,
            // Documents
            groomMarriageLicense: document.getElementById('groomMarriageLicense').value || '',
            groomBaptismalCert: document.getElementById('groomBaptismalCert').value || '',
            brideMarriageLicense: document.getElementById('brideMarriageLicense').value || '',
            brideBaptismalCert: document.getElementById('brideBaptismalCert').value || '',
            // Schedule
            interviewDate: document.getElementById('interviewDate').value || '',
            interviewTime: document.getElementById('interviewTime').value || '',
            seminarDate: document.getElementById('seminarDate').value || '',
            seminarTime: document.getElementById('seminarTime').value || '',
            // Sponsors
            sponsors: sponsors,
            status: 'pending',
            paymentStatus: 'pending',
            fee: 5000,
            submittedByEmail: 'admin@sjmp.com',
            requestNumber: requestNumber
        };
        
        console.log("ðŸ“¤ Submitting new request:", newRequest);
        addRequest(newRequest);
        modal.classList.remove('show'); 
        addRequestForm.reset();
    });

    filterButtons.forEach(button=>{
        button.addEventListener('click', ()=>{
            filterButtons.forEach(btn=>btn.classList.remove('active'));
            button.classList.add('active');
            currentFilter = button.dataset.status;
            applyFiltersAndSearch();
        });
    });

    // Search functionality
    function handleSearchInput(e) {
        currentSearchTerm = e.target.value;
        applyFiltersAndSearch();
    }

    headerSearchInput.addEventListener('input', handleSearchInput);
    tableSearchInput.addEventListener('input', handleSearchInput);

    // Table row click handling
    requestsTableBody.addEventListener('click',(e)=>{
        const row = e.target.closest('tr'); 
        if(!row || !row.dataset.id) return;
        const id = row.dataset.id; 
        const request = requests.find(r=>r._id===id);
        
        // Handle action buttons
        if(e.target.closest('.process-btn')) { 
            updateRequestStatus(id,'in-process'); 
            return; 
        }
        if(e.target.closest('.schedule-btn')) { 
            updateRequestStatus(id,'scheduled'); 
            return; 
        }
        if(e.target.closest('.complete-btn')) { 
            updateRequestStatus(id,'completed'); 
            return; 
        }
        if(e.target.closest('.approve-btn')) { 
            updateRequestStatus(id,'approved'); 
            return; 
        }
        if(e.target.closest('.reject-btn')) { 
            updateRequestStatus(id,'rejected'); 
            return; 
        }
        if(e.target.closest('.cancel-btn')) { 
            updateRequestStatus(id,'cancelled'); 
            return; 
        }
        if(e.target.closest('.reset-btn')) { 
            updateRequestStatus(id,'pending'); 
            return; 
        }
        if(e.target.closest('.payment-btn')) { 
            updatePaymentStatus(request);
            return; 
        }
        if(e.target.closest('.export-individual-btn')) { 
            exportIndividualRequest(request);
            return; 
        }
        
        // Show details modal
        if(request){
            showRequestDetails(request);
        }
    });

    // Update payment status
    function updatePaymentStatus(request) {
        Swal.fire({
            title: 'Update Payment Status',
            html: `
                <div class="form-group">
                    <label for="paymentDate">Payment Date:</label>
                    <input type="date" id="paymentDate" class="swal2-input" value="${new Date().toISOString().split('T')[0]}">
                </div>
                <div class="form-group">
                    <label for="paymentMethod">Payment Method:</label>
                    <select id="paymentMethod" class="swal2-input">
                        <option value="cash">Cash</option>
                        <option value="bank">Bank Transfer</option>
                        <option value="gcash">GCash</option>
                        <option value="check">Check</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="paymentReference">Reference Number:</label>
                    <input type="text" id="paymentReference" class="swal2-input" placeholder="Reference number">
                </div>
                <div class="form-group">
                    <label for="paymentNotes">Notes:</label>
                    <textarea id="paymentNotes" class="swal2-textarea" placeholder="Additional notes"></textarea>
                </div>
            `,
            showCancelButton: true,
            confirmButtonText: 'Mark as Paid',
            preConfirm: () => {
                const paymentData = {
                    paymentStatus: 'paid',
                    paymentDate: document.getElementById('paymentDate').value,
                    paymentMethod: document.getElementById('paymentMethod').value,
                    paymentReference: document.getElementById('paymentReference').value,
                    paymentNotes: document.getElementById('paymentNotes').value
                };
                
                if (!paymentData.paymentDate) {
                    Swal.showValidationMessage('Please enter payment date');
                    return false;
                }
                
                return paymentData;
            }
        }).then((result) => {
            if (result.isConfirmed) {
                fetch(`${baseURL}/${request._id}/payment`, {
                    method: 'PUT',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(result.value)
                })
                .then(res => res.json())
                .then(updatedRequest => {
                    showNotification('Payment status updated successfully!');
                    fetchRequests();
                })
                .catch(err => {
                    console.error('Failed to update payment:', err);
                    showNotification('Failed to update payment status', 'error');
                });
            }
        });
    }

    // Show request details
    function showRequestDetails(request) {
        currentDetailsRequest = request;
        
        let detailsHTML = `
            <div class="details-section">
                <h3 class="details-section-header">Basic Information</h3>
                <div class="details-grid">
                    <div class="detail-item">
                        <span class="detail-label">Request Number:</span>
                        <div class="detail-value">${displayValue(request.requestNumber)}</div>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Sacrament Type:</span>
                        <div class="detail-value">${displayValue(request.sacrament)}</div>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Status:</span>
                        <div class="detail-value"><span class="status-badge ${request.status}">${request.status}</span></div>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Created At:</span>
                        <div class="detail-value">${request.createdAt ? formatDate(request.createdAt) : 'N/A'}</div>
                    </div>
                </div>
            </div>

            <div class="details-section">
                <h3 class="details-section-header">Wedding Details</h3>
                <div class="details-grid">
                    <div class="detail-item">
                        <span class="detail-label">Wedding Date:</span>
                        <div class="detail-value">${formatDate(request.dateOfWedding)}</div>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Wedding Time:</span>
                        <div class="detail-value">${formatTime(request.timeOfWedding)}</div>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Fee:</span>
                        <div class="detail-value">â‚±${request.fee || 5000}.00</div>
                    </div>
                </div>
            </div>

            <div class="details-section">
                <h3 class="details-section-header">Groom Information</h3>
                <div class="details-grid">
                    <div class="detail-item">
                        <span class="detail-label">Full Name:</span>
                        <div class="detail-value">${request.groomName} ${request.groomMiddleName} ${request.groomSurname}</div>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Date of Birth:</span>
                        <div class="detail-value">${formatDate(request.groomDOB)}</div>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Age:</span>
                        <div class="detail-value">${request.groomAge}</div>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Place of Birth:</span>
                        <div class="detail-value">${request.groomPOB}</div>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Residence:</span>
                        <div class="detail-value">${request.groomResidence}</div>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Father's Name:</span>
                        <div class="detail-value">${request.groomFatherName}</div>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Mother's Maiden Name:</span>
                        <div class="detail-value">${request.groomMotherMaidenName}</div>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Contact Number:</span>
                        <div class="detail-value">${request.groomCP}</div>
                    </div>
                </div>
            </div>

            <div class="details-section">
                <h3 class="details-section-header">Bride Information</h3>
                <div class="details-grid">
                    <div class="detail-item">
                        <span class="detail-label">Full Name:</span>
                        <div class="detail-value">${request.brideName} ${request.brideMiddleName} ${request.brideSurname}</div>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Date of Birth:</span>
                        <div class="detail-value">${formatDate(request.brideDOB)}</div>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Age:</span>
                        <div class="detail-value">${request.brideAge}</div>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Place of Birth:</span>
                        <div class="detail-value">${request.bridePOB}</div>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Residence:</span>
                        <div class="detail-value">${request.brideResidence}</div>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Father's Name:</span>
                        <div class="detail-value">${request.brideFatherName}</div>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Mother's Maiden Name:</span>
                        <div class="detail-value">${request.brideMotherMaidenName}</div>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Contact Number:</span>
                        <div class="detail-value">${request.brideCP}</div>
                    </div>
                </div>
            </div>
        `;

        // Add documents section if any documents exist
        if (request.groomMarriageLicense || request.groomBaptismalCert || request.brideMarriageLicense || request.brideBaptismalCert) {
            detailsHTML += `
                <div class="details-section">
                    <h3 class="details-section-header">Required Documents</h3>
                    <div class="details-grid">
                        ${request.groomMarriageLicense ? `
                        <div class="detail-item">
                            <span class="detail-label">Groom's Marriage License:</span>
                            <div class="detail-value">${request.groomMarriageLicense}</div>
                        </div>
                        ` : ''}
                        ${request.groomBaptismalCert ? `
                        <div class="detail-item">
                            <span class="detail-label">Groom's Baptismal Certificate:</span>
                            <div class="detail-value">${request.groomBaptismalCert}</div>
                        </div>
                        ` : ''}
                        ${request.brideMarriageLicense ? `
                        <div class="detail-item">
                            <span class="detail-label">Bride's Marriage License:</span>
                            <div class="detail-value">${request.brideMarriageLicense}</div>
                        </div>
                        ` : ''}
                        ${request.brideBaptismalCert ? `
                        <div class="detail-item">
                            <span class="detail-label">Bride's Baptismal Certificate:</span>
                            <div class="detail-value">${request.brideBaptismalCert}</div>
                        </div>
                        ` : ''}
                    </div>
                </div>
            `;
        }

        // Add schedule section if any schedule exists
        if (request.interviewDate || request.seminarDate) {
            detailsHTML += `
                <div class="details-section">
                    <h3 class="details-section-header">Schedule</h3>
                    <div class="details-grid">
                        ${request.interviewDate ? `
                        <div class="detail-item">
                            <span class="detail-label">Interview Date:</span>
                            <div class="detail-value">${formatDate(request.interviewDate)}</div>
                        </div>
                        ` : ''}
                        ${request.interviewTime ? `
                        <div class="detail-item">
                            <span class="detail-label">Interview Time:</span>
                            <div class="detail-value">${formatTime(request.interviewTime)}</div>
                        </div>
                        ` : ''}
                        ${request.seminarDate ? `
                        <div class="detail-item">
                            <span class="detail-label">Seminar Date:</span>
                            <div class="detail-value">${formatDate(request.seminarDate)}</div>
                        </div>
                        ` : ''}
                        ${request.seminarTime ? `
                        <div class="detail-item">
                            <span class="detail-label">Seminar Time:</span>
                            <div class="detail-value">${formatTime(request.seminarTime)}</div>
                        </div>
                        ` : ''}
                    </div>
                </div>
            `;
        }

        // Add sponsors section if any sponsors exist
        if (request.sponsors && request.sponsors.length > 0 && request.sponsors.some(s => s !== '')) {
            detailsHTML += `
                <div class="details-section">
                    <h3 class="details-section-header">Sponsors</h3>
                    <div class="details-grid">
                        <div class="detail-item full-width">
                            <div class="detail-value">
                                ${request.sponsors.filter(s => s !== '').map(sponsor => `<div>${sponsor}</div>`).join('')}
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Add payment information
        detailsHTML += `
            <div class="details-section">
                <h3 class="details-section-header">Payment Information</h3>
                <div class="details-grid">
                    <div class="detail-item">
                        <span class="detail-label">Payment Status:</span>
                        <div class="detail-value"><span class="payment-badge ${getPaymentStatusClass(request.paymentStatus)}">${request.paymentStatus}</span></div>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Fee:</span>
                        <div class="detail-value">â‚±${request.fee || 5000}.00</div>
                    </div>
                    ${request.paymentDate ? `
                    <div class="detail-item">
                        <span class="detail-label">Payment Date:</span>
                        <div class="detail-value">${formatDate(request.paymentDate)}</div>
                    </div>
                    ` : ''}
                    ${request.paymentMethod ? `
                    <div class="detail-item">
                        <span class="detail-label">Payment Method:</span>
                        <div class="detail-value">${request.paymentMethod}</div>
                    </div>
                    ` : ''}
                    ${request.paymentReference ? `
                    <div class="detail-item">
                        <span class="detail-label">Reference Number:</span>
                        <div class="detail-value">${request.paymentReference}</div>
                    </div>
                    ` : ''}
                </div>
            </div>
        `;
        
        detailsContent.innerHTML = detailsHTML;
        detailsModal.classList.add('show');
    }

    closeDetails.addEventListener('click',()=>{
        detailsModal.classList.remove('show');
        currentDetailsRequest = null;
    });
    window.addEventListener('click',(e)=>{
        if(e.target===detailsModal) {
            detailsModal.classList.remove('show');
            currentDetailsRequest = null;
        }
    });

    // Individual export functionality
    function exportIndividualRequest(request) {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF({
            orientation: 'portrait',
            unit: 'mm',
            format: 'a4'
        });
        
        // Set document properties
        doc.setProperties({
            title: `Marriage Request - ${request.coupleName}`,
            subject: 'Marriage Request Details',
            author: 'San Jose Parish',
            keywords: 'marriage, request, parish',
            creator: 'San Jose Parish Management System'
        });
        
        // Add header
        doc.setFontSize(20);
        doc.setTextColor(27, 94, 32);
        doc.setFont('helvetica', 'bold');
        doc.text('SAN JOSE PARISH', 105, 20, { align: 'center' });
        
        doc.setFontSize(16);
        doc.setTextColor(0, 0, 0);
        doc.text('MARRIAGE REQUEST DETAILS', 105, 30, { align: 'center' });
        
        // Add request details
        let yPosition = 50;
        
        doc.setFontSize(12);
        doc.setFont('helvetica', 'bold');
        doc.text('REQUEST INFORMATION:', 20, yPosition);
        yPosition += 10;
        
        doc.setFont('helvetica', 'normal');
        doc.text(`Request Number: ${request.requestNumber || 'N/A'}`, 20, yPosition);
        yPosition += 7;
        doc.text(`Status: ${request.status.toUpperCase()}`, 20, yPosition);
        yPosition += 7;
        doc.text(`Created: ${request.createdAt ? formatDate(request.createdAt) : 'N/A'}`, 20, yPosition);
        yPosition += 15;
        
        // Wedding Details
        doc.setFont('helvetica', 'bold');
        doc.text('WEDDING DETAILS:', 20, yPosition);
        yPosition += 10;
        
        doc.setFont('helvetica', 'normal');
        doc.text(`Wedding Date: ${formatDate(request.dateOfWedding)}`, 20, yPosition);
        yPosition += 7;
        doc.text(`Wedding Time: ${formatTime(request.timeOfWedding)}`, 20, yPosition);
        yPosition += 7;
        doc.text(`Fee: â‚±${request.fee || 5000}.00`, 20, yPosition);
        yPosition += 15;
        
        // Groom Information
        doc.setFont('helvetica', 'bold');
        doc.text('GROOM INFORMATION:', 20, yPosition);
        yPosition += 10;
        
        doc.setFont('helvetica', 'normal');
        doc.text(`Name: ${request.groomName} ${request.groomMiddleName} ${request.groomSurname}`, 20, yPosition);
        yPosition += 7;
        doc.text(`Date of Birth: ${formatDate(request.groomDOB)}`, 20, yPosition);
        yPosition += 7;
        doc.text(`Age: ${request.groomAge}`, 20, yPosition);
        yPosition += 7;
        doc.text(`Place of Birth: ${request.groomPOB || 'N/A'}`, 20, yPosition);
        yPosition += 7;
        doc.text(`Residence: ${request.groomResidence || 'N/A'}`, 20, yPosition);
        yPosition += 7;
        doc.text(`Father: ${request.groomFatherName || 'N/A'}`, 20, yPosition);
        yPosition += 7;
        doc.text(`Mother: ${request.groomMotherMaidenName || 'N/A'}`, 20, yPosition);
        yPosition += 7;
        doc.text(`Contact: ${request.groomCP || 'N/A'}`, 20, yPosition);
        yPosition += 15;
        
        // Bride Information
        doc.setFont('helvetica', 'bold');
        doc.text('BRIDE INFORMATION:', 20, yPosition);
        yPosition += 10;
        
        doc.setFont('helvetica', 'normal');
        doc.text(`Name: ${request.brideName} ${request.brideMiddleName} ${request.brideSurname}`, 20, yPosition);
        yPosition += 7;
        doc.text(`Date of Birth: ${formatDate(request.brideDOB)}`, 20, yPosition);
        yPosition += 7;
        doc.text(`Age: ${request.brideAge}`, 20, yPosition);
        yPosition += 7;
        doc.text(`Place of Birth: ${request.bridePOB || 'N/A'}`, 20, yPosition);
        yPosition += 7;
        doc.text(`Residence: ${request.brideResidence || 'N/A'}`, 20, yPosition);
        yPosition += 7;
        doc.text(`Father: ${request.brideFatherName || 'N/A'}`, 20, yPosition);
        yPosition += 7;
        doc.text(`Mother: ${request.brideMotherMaidenName || 'N/A'}`, 20, yPosition);
        yPosition += 7;
        doc.text(`Contact: ${request.brideCP || 'N/A'}`, 20, yPosition);
        yPosition += 15;
        
        // Payment Information
        doc.setFont('helvetica', 'bold');
        doc.text('PAYMENT INFORMATION:', 20, yPosition);
        yPosition += 10;
        
        doc.setFont('helvetica', 'normal');
        doc.text(`Status: ${request.paymentStatus.toUpperCase()}`, 20, yPosition);
        yPosition += 7;
        
        if (request.paymentDate) {
            doc.text(`Paid on: ${formatDate(request.paymentDate)}`, 20, yPosition);
            yPosition += 7;
        }
        
        if (request.paymentMethod) {
            doc.text(`Method: ${request.paymentMethod}`, 20, yPosition);
            yPosition += 7;
        }
        
        // Add footer
        const pageHeight = doc.internal.pageSize.height;
        doc.setFontSize(10);
        doc.setTextColor(128, 128, 128);
        doc.text(`Generated on: ${new Date().toLocaleDateString()}`, 20, pageHeight - 20);
        doc.text('San Jose Parish Management System', 105, pageHeight - 20, { align: 'center' });
        doc.text(`Page 1 of 1`, 190, pageHeight - 20, { align: 'right' });
        
        // Save the PDF
        const fileName = `Marriage_Request_${request.coupleName.replace(/\s+/g, '_')}.pdf`;
        doc.save(fileName);
        
        showNotification('Request exported as PDF successfully!', 'success');
    }

    // Bulk export functionality
    document.getElementById('submitExportBtn').addEventListener('click', function() {
        const exportRange = document.getElementById('exportRange').value;
        let dataToExport = [];
        
        if (exportRange === 'current') {
            dataToExport = currentFilteredData;
        } else {
            dataToExport = requests;
        }
        
        if (dataToExport.length === 0) {
            showNotification('No data to export!', 'error');
            return;
        }
        
        exportMultipleRequests(dataToExport);
        exportModal.classList.remove('show');
    });

    function exportMultipleRequests(requests) {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF({
            orientation: 'portrait',
            unit: 'mm',
            format: 'a4'
        });
        
        // Set document properties
        doc.setProperties({
            title: 'Marriage Requests Report',
            subject: 'Multiple Marriage Requests',
            author: 'San Jose Parish',
            keywords: 'marriage, requests, parish, report',
            creator: 'San Jose Parish Management System'
        });
        
        let currentPage = 1;
        const maxRowsPerPage = 20;
        let rowCount = 0;
        
        // Add header
        doc.setFontSize(20);
        doc.setTextColor(27, 94, 32);
        doc.setFont('helvetica', 'bold');
        doc.text('SAN JOSE PARISH', 105, 20, { align: 'center' });
        
        doc.setFontSize(16);
        doc.setTextColor(0, 0, 0);
        doc.text('MARRIAGE REQUESTS REPORT', 105, 30, { align: 'center' });
        
        doc.setFontSize(10);
        doc.setTextColor(128, 128, 128);
        doc.text(`Generated on: ${new Date().toLocaleDateString()}`, 20, 40);
        doc.text(`Total Requests: ${requests.length}`, 105, 40, { align: 'center' });
        doc.text(`Page: ${currentPage}`, 190, 40, { align: 'right' });
        
        // Table headers
        let yPosition = 50;
        doc.setFontSize(10);
        doc.setFont('helvetica', 'bold');
        doc.setTextColor(0, 0, 0);
        
        // Draw table headers
        doc.text('Couple', 20, yPosition);
        doc.text('Wedding Date', 60, yPosition);
        doc.text('Time', 90, yPosition);
        doc.text('Status', 120, yPosition);
        doc.text('Payment', 150, yPosition);
        doc.text('Fee', 180, yPosition);
        
        // Draw line under headers
        yPosition += 3;
        doc.setDrawColor(0, 0, 0);
        doc.line(20, yPosition, 190, yPosition);
        yPosition += 7;
        
        // Add request rows
        doc.setFont('helvetica', 'normal');
        doc.setFontSize(9);
        
        requests.forEach((request, index) => {
            // Check if we need a new page
            if (rowCount >= maxRowsPerPage) {
                doc.addPage();
                currentPage++;
                yPosition = 20;
                
                // Add header for new page
                doc.setFontSize(10);
                doc.setTextColor(128, 128, 128);
                doc.text(`Page: ${currentPage}`, 190, yPosition, { align: 'right' });
                yPosition += 20;
                
                // Table headers for new page
                doc.setFontSize(10);
                doc.setFont('helvetica', 'bold');
                doc.setTextColor(0, 0, 0);
                
                doc.text('Couple', 20, yPosition);
                doc.text('Wedding Date', 60, yPosition);
                doc.text('Time', 90, yPosition);
                doc.text('Status', 120, yPosition);
                doc.text('Payment', 150, yPosition);
                doc.text('Fee', 180, yPosition);
                
                yPosition += 3;
                doc.line(20, yPosition, 190, yPosition);
                yPosition += 7;
                
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(9);
                rowCount = 0;
            }
            
            // Add request data
            const coupleName = request.coupleName.length > 25 ? request.coupleName.substring(0, 25) + '...' : request.coupleName;
            doc.text(coupleName, 20, yPosition);
            doc.text(formatDate(request.weddingDate), 60, yPosition);
            doc.text(formatTime(request.weddingTime), 90, yPosition);
            doc.text(request.status, 120, yPosition);
            doc.text(request.paymentStatus, 150, yPosition);
            doc.text(`â‚±${request.fee || 5000}`, 180, yPosition);
            
            yPosition += 5;
            rowCount++;
            
            // Add a subtle line between rows (every 5 rows for readability)
            if (index < requests.length - 1 && (index + 1) % 5 === 0) {
                doc.setDrawColor(200, 200, 200);
                doc.line(20, yPosition, 190, yPosition);
                yPosition += 2;
            }
        });
        
        // Add footer
        const pageHeight = doc.internal.pageSize.height;
        doc.setFontSize(8);
        doc.setTextColor(128, 128, 128);
        doc.text('San Jose Parish Management System', 105, pageHeight - 10, { align: 'center' });
        
        // Save the PDF
        const fileName = `Marriage_Requests_Report_${new Date().toISOString().split('T')[0]}.pdf`;
        doc.save(fileName);
        
        showNotification(`${requests.length} requests exported as PDF successfully!`, 'success');
    }

    // Individual export button in details modal
    exportIndividualBtn.addEventListener('click', function() {
        if (currentDetailsRequest) {
            exportIndividualRequest(currentDetailsRequest);
            detailsModal.classList.remove('show');
        }
    });

    // Initialize
    fetchRequests();

    // Logout
    const logoutLink = document.getElementById("logoutLink");
    logoutLink.addEventListener("click",(e)=>{
        e.preventDefault();
        Swal.fire({
            title:'Are you sure you want to log out?',
            text:"You will be redirected to the login page.",
            icon:'warning',
            showCancelButton:true,
            confirmButtonColor:'#3085d6',
            cancelButtonColor:'#d33',
            confirmButtonText:'Yes, log me out!'
        }).then((result)=>{
            if(result.isConfirmed){window.location.href="index.html";}
        });
    });
});
</script>
</body>
</html>